---
import Base from '../../layouts/Base.astro';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('lobster-blog');
  return posts.map((post) => ({
    params: { slug: post.data.slug ?? post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Base title={post.data.title} description={post.data.summary ?? post.data.title}>
  <main class="max-w-3xl mx-auto px-4 py-16">
    <nav class="mb-8 text-sm">
      <a href="/lobster-incubator/blog" class="text-node-blue hover:text-text-primary">← Back to Field Notes</a>
    </nav>

    <article class="space-y-6">
      <header class="space-y-3">
        <div class="flex items-center gap-3 flex-wrap">
          <time class="font-mono text-xs text-text-muted">{post.data.date}</time>
          {post.data.tags.map((tag) => (
            <a href={`/lobster-incubator/tag/${tag}`} class="bg-bg-secondary border border-border text-xs text-text-muted px-2 py-1 rounded-full hover:border-node-blue hover:text-node-blue transition-colors">{tag}</a>
          ))}
        </div>
        <h1 class="text-3xl font-bold text-text-primary leading-tight">{post.data.title}</h1>
        {post.data.summary && (
          <p class="text-lg text-text-muted leading-relaxed">{post.data.summary}</p>
        )}
      </header>

      <hr class="border-border" />

      <div class="prose prose-invert prose-sm max-w-none
        prose-headings:text-text-primary prose-headings:font-semibold
        prose-p:text-text-secondary prose-p:leading-relaxed
        prose-a:text-node-blue prose-a:no-underline hover:prose-a:underline
        prose-code:text-edge-green prose-code:bg-bg-secondary prose-code:px-1 prose-code:rounded
        prose-pre:bg-bg-secondary prose-pre:border prose-pre:border-border
        prose-strong:text-text-primary
        prose-li:text-text-secondary">
        <Content />
      </div>
    </article>

    <nav class="mt-12 pt-6 border-t border-border">
      <a href="/lobster-incubator/blog" class="text-node-blue hover:text-text-primary text-sm">← All Field Notes</a>
    </nav>
  </main>
</Base>
